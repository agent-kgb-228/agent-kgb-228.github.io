<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Продажа ЖД билетов</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .wagon {
            border: 1px solid #ccc;
            margin: 10px;
            padding: 10px;
        }
        .seat {
            display: inline-block;
            width: 30px;
            height: 30px;
            margin: 5px;
            text-align: center;
            line-height: 30px;
            cursor: pointer;
        }
        .occupied {
            background-color: red;
            color: white;
        }
        .available {
            background-color: green;
            color: white;
        }
    </style>
</head>
<body>

<h1>Продажа ЖД билетов</h1>
<h3>Поезд 6142С Горная - Болотная</h3>
<div id="seats-container"></div>

<h3>Выберите место</h3>
<p id="message"></p>

<script>
    const numWagons = 9;
    const numCoupe = 2;
    const seatsPerCoupe = 2;
    const numPlatzkartSeats = 6;

    // Создание структуры для вагонов и мест
    let train = [];

    for (let i = 0; i < numWagons; i++) {
        if (i < numWagons - 1) {
            // Создание вагонов с купе
            let coupe = [];
            for (let j = 0; j < numCoupe; j++) {
                coupe.push(Array(seatsPerCoupe).fill(false)); // false означает, что место свободно
            }
            train.push(coupe);
        } else {
            // Создание плацкарта
            train.push(Array(numPlatzkartSeats).fill(false)); // все места свободны
        }
    }

    function renderSeats() {
        const container = document.getElementById('seats-container');
        container.innerHTML = '';
        
        train.forEach((wagon, wagonIndex) => {
            const wagonDiv = document.createElement('div');
            wagonDiv.className = 'wagon';
            wagonDiv.innerHTML = `<strong>Вагон ${wagonIndex + 1}</strong>`;
            
            if (wagonIndex < numWagons - 1) {
                wagon.forEach((coupe, coupeIndex) => {
                    const coupeDiv = document.createElement('div');
                    coupeDiv.innerHTML = `<strong>Купе ${coupeIndex + 1}: </strong>`;
                    
                    coupe.forEach((occupied, seatIndex) => {
                        const seatDiv = document.createElement('div');
                        seatDiv.innerText = 'К';
                        seatDiv.className = occupied ? 'seat occupied' : 'seat available';
                        seatDiv.onclick = () => selectSeat(wagonIndex, coupeIndex, seatIndex);
                        coupeDiv.appendChild(seatDiv);
                    });
                    wagonDiv.appendChild(coupeDiv);
                });
            } else {
                wagon.forEach((occupied, seatIndex) => {
                    const seatDiv = document.createElement('div');
                    seatDiv.innerText = 'П';
                    seatDiv.className = occupied ? 'seat occupied' : 'seat available';
                    seatDiv.onclick = () => selectSeat(wagonIndex, null, seatIndex);
                    wagonDiv.appendChild(seatDiv);
                });
            }

            container.appendChild(wagonDiv);
        });
    }

    function selectSeat(wagonIndex, coupeIndex, seatIndex) {
        let isPlatzkart = (wagonIndex === numWagons - 1);

        if (isPlatzkart) {
            if (train[wagonIndex][seatIndex]) {
                alert('Это место занято!');
            } else {
                // Предложение о покупке плацкарта
                train[wagonIndex][seatIndex] = true;
                alert(`Вы купили плацкартное место в вагоне ${wagonIndex + 1}, место ${seatIndex + 1}.`);
                renderSeats();
            }

        } else {
            if (train[wagonIndex][coupeIndex][seatIndex]) {
                alert('Это место занято!');
            } else {
                // Проверка на возможность покупки купе
                let coupeOccupied = train[wagonIndex][coupeIndex].every(occupied => occupied);
                if (coupeOccupied) {
                    alert('Все места в этом купе заняты!');
                    return;
                }
                train[wagonIndex][coupeIndex][seatIndex] = true;
                alert(`Вы купили место в вагоне ${wagonIndex + 1}, купе ${coupeIndex + 1}, место ${seatIndex + 1}.`);
                renderSeats();
            }
        }

        checkAllSold();
    }

    function checkAllSold() {
        const allSold = train.flat().every((wagon) => {
            // Если это плацкарт, возвращаем true если все заняты
            if (Array.isArray(wagon)) {
                return wagon.every(seat => seat);
            }
            // Если это купе, возвращаем true если все заняты
            return wagon; // для последнего вагона с плацкартом
        });

        if (allSold) {
            const shouldRestart = confirm('Все места выкуплены! Перезапустить?');
            if (shouldRestart) {
                resetTrain();
            }
        }
    }

    function resetTrain() {
        train = [];
        for (let i = 0; i < numWagons; i++) {
            if (i < numWagons - 1) {
                let coupe = [];
                for (let j = 0; j < numCoupe; j++) {
                    coupe.push(Array(seatsPerCoupe).fill(false));
                }
                train.push(coupe);
            } else {
                train.push(Array(numPlatzkartSeats).fill(false));
            }
        }
        renderSeats();
    }

    // Инициализация
    renderSeats();
</script>
</body>
</html>